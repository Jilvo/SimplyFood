{% extends "base.html" %}
{% load static %}
{% block content %}
<!--Custom styles-->
<title>Connexion</title>
<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

<body id="page-top" class="signup">

<body id="page-top" class="signup"></body>
<style>
	footer{
		position: fixed;
		
	}
</style>

<!--Login Form-->
<header class="masthead">
  <section>
  <!-- <button onclick="Add_Row()">Call function</button> -->
  
  <button value="Add a field" class="add" id="add" onclick="add_row()">Add a field</button>
  <button value="Generate" class="add" id="preview" onclick="extract_to_json()">Generate</button>
  <!-- <form action="{% url 'recipe' %}" method="POST" accept-charset="utf-8">
    {% csrf_token %} -->
  <button value="" class="" id="" onclick="send_json()">Send Json</button>
  <!-- </form> -->
  <table id="table_recipe" class="table table-bordered table-dark">
    <thead>
      <tr>
        <th scope="col">Jour</th>
        <th scope="col">Déjeuner</th>
        <th scope="col">Dîner</th>
        <th scope="col">Delete</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</fieldset>
  &nbsp;
  <script>
    // Increment row
    var i = 0;
     function buttonClick() {
        i++;
     }
     //add one row
    let add_row = function() {
      let tbody = $("tbody");
      const row_id = tbody.length + i;
      buttonClick()
      $("tbody").append(`
      <tr id=tr_row_${row_id}>
        <td>${row_id}</td>
        <td><input class='form-control mr-sm-2 input_recipe recipe_input' placeholder='Faire une recherche' name='lunch' id='lunch_${row_id}'></td>
        <td><input class='form-control mr-sm-2 input_recipe recipe_input' placeholder='Faire une recherche' name='supper' id='supper_${row_id}'></td>
        <td><input type="button" class="remove btn btn-outline-secondary" onclick="remove_row(${row_id})" value="Remove"/></td>
      </tr>
      `
      );
    }
    // delete a specific row
    let remove_row = function(row_id) {
      $("#tr_row_"+ row_id).remove();
    }
    // create Json with all of the input
    let extract_to_json = function(row_id) {
      console.log("Json crée")
      let results = []
      // console.log($("tr .recipe_input").val());
      // $("tr .recipe_input").each(() =>{ 
      //   console.log($(this).val());
      // });
      $('tr .recipe_input').each(function () {
      
      results.push($(this).val())
      });
      return results
    };

    // post with ajax,the data is the Json's recipe
    let send_json = function(){
      let json_list = extract_to_json()
      console.log(json_list)
      $.ajax({
      type: 'GET',
		  url: "/recipe",
		  data: {
        json_list : json_list,
      },
      success: function(data, textStatus, xhr) {
        console.log(xhr.status);
      },
      complete: function(xhr, textStatus) {
        console.log(xhr.status);
      },
		  dataType: "json"
		});
  };
		


  </script>

  </section>

</header>
{% endblock %}
